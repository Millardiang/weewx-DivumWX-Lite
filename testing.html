<!doctype html>
<html lang="us">
<!-- The page take the information inputted by the client and sends them a file called services.txt which is used in the -->
<!-- installation of the Weather34 skin template on a WeeWX Personal Weather Station system. -->
<!-- Original code written by Ian Millard -->
<!-- Rewritten on Feburary 2021 by Steven Sheeley, reusing the file saving routine -->
<!-- Whilst it was attempted to maintain the look and feel of the original, all -->
<!-- html, css and javascript used in the new page is by Steven Sheeley -->

<head>
    <meta charset="utf-8">
    <title>Weather34 services.txt generator form</title>
    <meta name="description" content="This form generates the services.txt file that is needed to install the Weather34 skin and modify the weewx conf file." />
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <style>
        .container { 
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            margin: auto;
            gap: 5px 5px;
            width: 75%;
            border: 2px solid #000000;
            background-color: #dbdada94;
            padding: 4px;
            border-radius: 12px;
            box-shadow: 5px 5px 5px #4b8f29;
            grid-auto-flow: row;
            grid-template-areas:
                "Banner Banner Banner Banner"
                "Section-1 Section-1 Section-1 Map"
                "Section-2 Section-2 Section-2 Section-2"
                "Services Services Services Services"
                "Footer Footer Footer Footer";
        }
        .Banner {
            grid-area: Banner;
            padding: 6px;
            border-radius: 10px;
            border: 2px solid #000000;
            background-color: #fff;
            border-style: inset;
        }
        .Section-1 {
            grid-area: Section-1;
            padding: 8px;
            background-color: #83bdff;
            border-radius: 10px;
            border: 2px solid #000000;
        }
        .Map {
            grid-area: Map;
            position: relative;
            border-radius: 10px;
            border: 2px solid #000000;
        }
        .Section-2 { grid-area: Section-2;
            background-color: #83bdff;
            border-radius: 10px;
            border: 2px solid #000000;
        }
        .Services { grid-area: Services;
            background-color: #fff;
        }
        .Footer { grid-area: Footer;
            background-color: #828283;
        }
        #mapid {
            position: relative;
            height: 300px;
            width: 300px;
            background-color: #fff;
        }
        hr {
            border: 3px double;
            width: 60%;
        }
        h3 {
            color: #000000;
            font-size: 150%;
        }
        input[type=text] {
            width: 90%;
            border: 1px solid #000;
            border-radius: 10px;
            padding: 10px;
        }
        select {
            width: 90%;
            border: 1px solid #000;
            border-radius: 10px;
            padding: 10px;
        }
        .radiogroup {
            width: auto;
        }
        .myButton {
            box-shadow: 0px 10px 14px -7px #3e7327;
            background: linear-gradient(to bottom, #77b55a 5%, #72b352 100%);
            background-color: #77b55a;
            border-radius: 4px;
            border: 1px solid #4b8f29;
            display: inline-block;
            cursor: pointer;
            color: #ffffff;
            font-family: Arial;
            font-size: 14px;
            font-weight: bold;
            padding: 10px 4px;
            text-decoration: none;
            text-shadow: 0px 1px 11px #5b8a3c;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
</head>
<body>
    <!-- Begin Container -->
    <div class="container">
        <div class="Banner">
            <div style="text-align: center">
                <h3>Weather34 services.txt Generator</h3>
            </div>
            <div style="text-align: center">This form is designed to create the required <b>services.txt</b> file for the WeeWX Weather34 skin installation. Fill out the form below with the requested information. Each one of the optional inputs has a Yes/No radio button. The default is No and the text input field is disabled. You may leave them empty if you do not have that service/information. If you want more information, there is a link you can visit for each one of them in the description. If you have a API key or an ID for one of those services, click on the <b>Yes</b> button and enter the required information. Each of the inputs also have more information available if you hover over the <b>?</b>.<br /> Once you've completed the form click the download button. This will automatically send you the file called <i><b>settings.txt</b></i> which you can save to your default download (or any) folder. Once the download is complete, copy the file to the directory that you downloaded the Weather34 Archive file to. Once this is complete, you are ready to do the base installation of the Weather34 Skin.</div><br />
            <div style="text-align: center"><i class="fa-solid fa-circle-exclamation">&nbsp<b>Notice: When you first enter this page, you will see a popup question on the left hand side of the webpage, near the menu button, asking of this website can access your location. <i>Don't panic!!</i> We're not tracking you. The map to the right uses a feature that, if you allow this page to do so, will scroll to your approximate location on the map and then you are able to better refine your latitude and longitude by scrolling and clicking to auto fill the text boxes below.  If you choose to not allow that, you can still drag and scroll to your location and then click to do the same thing.</b></i></div><br />
            <div style="text-align: center"><i class="fa-solid fa-circle-exclamation">&nbsp<b>No data is retained on this server after the process is complete.</b></div><br />
            <div style="text-align: center"><i class="fa-solid fa-circle-exclamation">&nbsp<b>Darksky as been removed as a service and has been replaced by <a href"https://www.aerisweather.com/">Aeris Weather</a> because Darksky is no longer accepting any new account, and Aeris Weather still provides a free service.</div></b>
        </div>
        <div class="Section-1">
            <h4> Weather Station Location, Language and IP Address Section</h4>
            <label for="text">Latitude</label>&nbsp;&nbsp;<i class="fa fa-question-circle" title="Please select the location of your weather station on the map to the right by scrolling to where it's physically located and clicking on the map at that location. Your latitude and longitude will then be automatically filled out on the form to the left."></i><br/>
            <input type="text" id="txtLat"><br />
            <label for="text">Longitude</label>&nbsp;&nbsp;<i class="fa fa-question-circle" title="Please select the location of your weather station on the map to the right by scrolling to where it's physically located and clicking on the map at that location. Your latitude and longitude will then be automatically filled out on the form to the left."></i><br/>
            <input type="text" id="txtLon"><br />
            <label for="text">Website Language</label>&nbsp;&nbsp;<i class="fa fa-question-circle" title="Please select your language from the list below"></i><br />
            <select id="selLang">
                <option selected value="">-- Please Choose Your Language--</option>
                <option value="en">English</option>
                <option value="de">German</option>
                <option value="fr">French</option>
                <option value="es">Spanish</option>
                <option value="it">Italian</option>
                <option value="br">Portuguese (Br)</option>
                <option value="ru">Russian</option>
            </select><br />
            <label for="text">Local Web Server IP Address</label>&nbsp;&nbsp;<i class="fa fa-question-circle" title="Enter the Weather Station's Web Server IP Address"></i>
            <input type="text" id="txtSrvIP" />
        </div>
        <div class="Map" id="mapid" style="text-align: center"></div>
        <div class="Section-2">
            <h4>Aeris Weather Key/Secret Entry Section</h4>
            Do you have a Aeris Weather  Account?&nbsp;&nbsp;<i class="fa fa-question-circle" title="This field is disabled until you click on the Radio button for Yes. Then you will be able to enter your Aeris Weather Key."></i>
            <label class="radio"><input type="radio" name="awKeyChkd" id="awKeyChkd" onclick="EnableDisableDSK()" />Yes</label>
            <label class="radio"><input type="radio" name="awKeyChkd" id="awKeyChkd" onclick="EnableDisableDSK()" checked />No</label>
            <input type="text" id="txtAwKey" disabled="true" /><br />
            <label for="text">Aeris Weather Key</label><i class="fa fa-question-circle" title="This field is disabled until you click on the Radio button for Yes. Then you will be able to enter your Aeris Weather Key."></i><br />
            <input type="text" id="txtAwSecret" disabled="true" /><br />
            <label for="text">Aeris Weather Secret</label><i class="fa fa-question-circle" title="This field is disabled until you click on the Radio button for Yes. Then you will be able to enter your Aeris Weather Secret."></i><br />
            <hr>
            <h4>World Air Pollution API Key Entry Section</h4>
            Do you have a AQI Key?&nbsp;<i class="fa fa-question-circle" title="This field is disabled until you click on the Radio button for Yes. Then you will be able to enter your AQI Key."></i>
            <label class="radio"><input type="radio" name="aqKeychkd" id="aqKeychkd" onclick="EnableDisableAQI()" />Yes</label>
            <label class="radio"><input type="radio" name="aqKeychkd" id="aqKeychkd" onclick="EnableDisableAQI()" checked />No</label><br /> If you do not have any AQI Key, you can learn more at <a href="https://aqicn.org/json-api/doc/" target="_blank" rel="noopener noreferrer">AQI API Info</a> or get your Key (token) <a href="https://aqicn.org/data-platform/token/#/" target="_blank" rel="noopener noreferrer">here</a>
            <input type="text" id="txtAqkey" disabled="true" /><br />
            <hr>

        </div>
        <div class="Services">Services</div>
        <div class="Footer">Footer</div>
      </div>
    <!-- End Container-->
    <script>
        var mymap = L.map('mapid').fitWorld();
        var txtLat = document.getElementById('txtLat');
        var txtLon = document.getElementById('txtLon');
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 22,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' + 'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1
        }).addTo(mymap);
        function onLocationFound(e) {
            var radius = e.accuracy / 2;
        }
        function onLocationError(e) {
            alert(e.message);
        }
        mymap.on('locationfound', onLocationFound);
        mymap.on('locationerror', onLocationError);
        mymap.locate({
            setView: true
        });
        mymap.on('click', function(e) {
            txtLat.value = +e.latlng.lat.toFixed(6);
            txtLon.value = +e.latlng.lng.toFixed(6);
        });
    </script>
    <!--Aeris Weather-->
    <script type="text/javascript">
        function EnableDisableAQI() {
            var awKeyChkd = document.getElementById("awKeychkd");
            var txtAwKey = document.getElementById("txtAwKey");
            var txtAwSecret = document.getElementById("txtAwSecret");
            txtAqkey.disabled = aqKeychkd.checked ? false : true;
            if (!txtAqkey.disabled) {
                txtAqkey.focus();
            }
        }
    </script>
    <!--World Air Pollution-->
    <script type="text/javascript">
        function EnableDisableAQI() {
            var aqKeychkd = document.getElementById("aqKeychkd");
            var txtAqkey = document.getElementById("txtAqkey");
            txtAqkey.disabled = aqKeychkd.checked ? false : true;
            if (!txtAqkey.disabled) {
                txtAqkey.focus();
            }
        }
    </script>

</body>
</html>
